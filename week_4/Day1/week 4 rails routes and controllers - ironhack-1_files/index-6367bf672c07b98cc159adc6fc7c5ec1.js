var jQuery=$;window.NameAndDescription=Backbone.Model.extend({defaults:{name:"",description:""},sync:function(a,b,c){return Backbone.sync("update",b,c)}}),window.NameAndDescriptionView=Backbone.View.extend({initialize:function(){return this.$editHint=this.$(".edit-hint"),this.$title=this.$("#title"),this.$titleText=this.$("#title h1"),this.$titleEditor=this.$("#title .editor"),this.$editor=this.$("textarea.editor"),this.$descriptionBody=this.$(".body"),this.$contents=this.$(".body .description_wrapper"),this.$formatLink=this.$(".format-link"),this.$arrow=this.$(".options .arrow"),this.$formatHelp=this.$(".how_to_format"),this.$footer=this.$(".description-footer"),this.$controls=this.$(".controls"),this.$save=this.$(".controls .save"),this.$cancel=this.$(".controls .reset"),this.mode=this.options.mode||"display",this.setPlaceholder(),this.render()},render:function(){return this.mode==="editable"?this.showEditable():this.mode==="display"?(this.showNonEditable(),this.hideEditHint()):this.showNonEditable()},events:{"click .edit-hint":"showEditable",mouseover:"showEditHint",mouseout:"hideEditHint","click .save":"save","click .reset":"cancel","click .format-link":"toggleFormatHelp","input .editor":"highlightSave"},showEditHint:function(){if(this.mode==="display")return this.$contents.addClass("hover"),this.$editHint.show()},hideEditHint:function(){if(this.mode==="display")return this.$contents.removeClass("hover"),this.$editHint.hide()},showEditable:function(){return this.hideEditHint(),this.mode="editable",this.$beforeEditVal=this.$editor.val(),this.$beforeTitleEditVal=this.$titleEditor.val(),this.$titleEditor.show(),this.$editor.show(),this.$controls.show(),this.$save.show(),this.$cancel.show(),this.$footer.show(),this.$titleText.hide(),this.$descriptionBody.hide(),this.focusOnEditor(),!1},showNonEditable:function(){return this.mode="display",this.unHighlightSave(),this.$descriptionBody.show(),this.$titleText.show(),this.$controls.show(),this.$footer.hide(),this.$titleEditor.hide(),this.$editor.hide(),this.$cancel.show(),this.$save.hide(),this.emptyDescription()&&this.$contents.html(""),this.showEditHint(),!1},highlightSave:function(){return this.$save.addClass("highlighted")},unHighlightSave:function(){return this.$save.removeClass("highlighted")},emptyDescription:function(){return $.trim(this.$contents.html())===""},hasDescription:function(){return!this.emptyDescription()},toggleEditable:function(){return this.$footer.is(":hidden")?this.showEditable():this.showNonEditable()},setPlaceholder:function(){return this.$editor.attr("placeholder","Add a description"),this.$titleEditor.attr("placeholder","Add a title")},save:function(){var a=this;return this.model.save({name:this.$titleEditor.val(),markdown_description:this.$editor.val()},{only:["name","markdown_description"],success:function(b){return b.attributes.markdown_description?(a.$contents.html(b.attributes.description),a.$editor.val(b.attributes.markdown_description)):(a.$contents.html(""),a.$editor.val("")),b.attributes.name?a.$titleText.html(b.attributes.name):a.$titleText.html(""),a.showNonEditable(),a.model.save({description:b.attributes.description}),a.$el.trigger("saved")},error:function(){return statusBar.error("Failed to save the title and description.")}}),!1},cancel:function(){return this.$editor.val(this.$beforeEditVal),this.$titleEditor.val(this.$beforeTitleEditVal),this.showNonEditable(),!1},focusOnEditor:function(){return this.$titleEditor.focus().select()},toggleFormatHelp:function(){return this.$formatHelp.is(":visible")?this.hideFormatHelp():this.showFormatHelp(),!1},hideFormatHelp:function(){var a=this;return this.$footer.animate({backgroundColor:"transparent"},100),this.$save.removeClass("dark"),this.$cancel.removeClass("dark"),this.$formatHelp.slideUp(200,"easeInSine",function(){return a.$arrow.removeClass("open")})},showFormatHelp:function(){return this.$formatHelp.slideDown(400,"easeOutSine"),this.$footer.css("background-color","#f1efeb"),this.$save.addClass("dark"),this.$cancel.addClass("dark"),this.$arrow.addClass("open")}});var MediaNameAndDescription,hideToggler,showToggler;canUpdateMedia&&(MediaNameAndDescription=NameAndDescription.extend({namespace:"media",url:""+WistiaContext.media.update_name_and_desc_url+".json"}),window.mediaNameAndDescription=new MediaNameAndDescription({name:WistiaContext.media.name,description:WistiaContext.media.description}),window.mdv=new NameAndDescriptionView({el:$(".title_and_description"),model:mediaNameAndDescription}),window.theMediaEmbed&&theMediaEmbed.bind&&(hideToggler=function(){if(theMediaEmbed.width()>=960)return $(".size_toggler").hide()},showToggler=function(){return $(".size_toggler").show()},theMediaEmbed.bind("play",hideToggler),theMediaEmbed.bind("pause",showToggler).bind("end",showToggler))),$("#media_controls a.comment").click(function(){return $.scrollTo(ta,500,function(){return $("#comments textarea:last").focus()}),!1}),function(a){var b,c,d;if(!window.showBreadCrumbs||!a._detect.localStorage())return $("#media_bar").find("a.next, a.previous").remove();c="project."+WistiaContext.project.hashedId+".media_hashed_id_cache",b=a.localStorage(c),d=function(){var a,c,d;a=_.indexOf(b.hashedIds,WistiaContext.media.hashedId),a+1<b.hashedIds.length&&(c=b.hashedIds[a+1]),a-1>=0&&(d=b.hashedIds[a-1]),c&&($("#media_bar a.next").show().attr("href","/medias/"+c),$.hotkey("k",function(){return location.href=$("#media_bar a.next").attr("href")}));if(d)return $("#media_bar a.previous").show().attr("href","/medias/"+d),$.hotkey("j",function(){return location.href=$("#media_bar a.previous").attr("href")})};if(!b||b.updatedAt!==WistiaContext.project.updated_at)return $.getJSON("/projects/"+WistiaContext.project.hashedId+"/medias/get_hashed_ids.json",function(e){return a.localStorage(c,{updatedAt:WistiaContext.project.updated_at,touchedAt:(new Date).getTime(),hashedIds:e}),b=a.localStorage(c),d()});if(b)return a.localStorage(""+c+".touchedAt",(new Date).getTime()),d()}(Wistia);var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};(function(a){var b;return window.ReplaceVideoStatusBar=function(a){function d(){return b=d.__super__.constructor.apply(this,arguments),b}var c;return __extends(d,a),c=999999999,d.prototype._addEventHandlers=function(){var a=this;return d.__super__._addEventHandlers.apply(this,arguments),this.$messagesEl.off("click"),this.$messagesEl.on("click",".info.message, .error.message",function(b){return a.clearMessage(b)}),this.$messagesEl.on("click",".remove",function(b){return a.clearMessage(b)}),this.$messagesEl.on("click",".cancel",function(b){return b.stopPropagation(),a.onCancel(b)})},d.prototype.success=function(a,b){return b==null&&(b={}),b.life=c,this._add($("<div class='success message'>"+a+"<div class='remove'></div></div>"),b),this},d.prototype.failed=function(a,b){return b==null&&(b={}),b.life=c,this._add($("<div class='failed message'>"+a+"<div class='remove'></div></div>"),b),this},d.prototype.progressing=function(a,b){var d;b==null&&(b={});if(this.$messagesEl.find("#replace-media-progress").length>0)return;return b.life=c,d="<div id='replace-media-progress' class='html5-progress progress message'>          <div class='html5-progress-bar'>            <div class='html5-progress-text'>            </div>          </div>          <div class='text'>"+a+"</div>          <div class='cancel'>Cancel</div>        </div>",this._add($(d),b),this.progress=new Html5Progress("replace-media-progress",{percent:b.percent})},d.prototype.update_progress=function(a,b){return this.progress.update(a),this.$messagesEl.find(".text").text(b)},d.prototype.showRemoveButton=function(){var a;if(!(a=this.$messagesEl.find(".cancel")))return;return a.addClass("remove").removeClass("cancel").text("")},d.prototype.onCancel=function(a){var b;return console.log("cancelled"),typeof (b=this.options).onCancel=="function"?b.onCancel():void 0},d}(window.FloatingStatusBar)})(Wistia);var ReplaceVideoStatusPoller;ReplaceVideoStatusPoller=function(){function n(){}var a,b,c,d,e,f,g,h,i,j,k,l,m;return a=wJQuery,j=null,e=5e3,g="This video is currently queued for replacement.",f="This video is being replaced (#{}% encoded). The old version will continue to display until this is complete.",b="Encoding failed. Before trying again, check out our Help Center for <a href='http://wistia.com/doc/upload-video'>upload best practices</a>.",d="Success! All embedded instances now reflect this new version.",h="Success! All embedded instances now reflect this new version and a copy of the old version has been saved in this project.",i=null,k=null,l=function(a){return a==null&&(a=0),f.replace("#{}",a.toString())},m=function(){var a=this;return window.statusBar=new ReplaceVideoStatusBar({anchor:"#status_bar_anchor"}),window.statusBar.onCancel=function(){return n.cancelReplacement()}},n.start=function(a){a==null&&(a={}),j==null&&(j=new c(a)),this.cancel_url=a.urls.cancel,m(),k=a.replacementMethod;try{j.start()}catch(b){console.log("MediaStatusPoller failed"),j.stop()}return j},n.cancelReplacement=function(){return j.stop(),statusBar.update_progress(0,"Cancelling replacement..."),a.ajax({url:n.cancel_url,success:function(a){return statusBar.update_progress(0,a.message),statusBar.showRemoveButton(),j.stop()}})},n.showReplacementMedia=function(){var a;return j.status===2?(k==="swap"?a=h:a=d,Cookies.set("replacement_message",a),location.replace(location.href)):console.log("Replacement media not ready")},c=function(){function i(a){a==null&&(a={}),this.status_url=a.urls.status,this.status=a.status,this.progress=Math.round(a.progress*100),this.poller=null}var c,d,f,h;return f=0,d=1,h=2,c=-1,i.prototype.start=function(){return this.status===-1?this._showFailed():this.run()},i.prototype.stop=function(){return clearInterval(this.poller),delete this.poller},i.prototype.run=function(){var a=this;return console.log("running..."),this.displayStatus(),this.poller=setInterval(function(){return a.fetchStatus()},e)},i.prototype.fetchStatus=function(){var b=this;return a.ajax({url:this.status_url,method:"get",success:function(a){return b.status=a.status,b.progress=Math.round(a.progress*100),console.log(b.status,b.progress),b.displayStatus()},error:function(a){return b.errorCount||(b.errorCount=0),b.errorCount+=1,b.errorCount>=5&&b.stop(),console.dir(a)}})},i.prototype.displayStatus=function(){switch(this.status){case f:return this._showQueued();case d:return this._showProcessing();case h:return this._showReady();case c:return this._showFailed()}},i.prototype._showQueued=function(){return statusBar.progressing(g)},i.prototype._showProcessing=function(){var a;return a=this.progress,this.status===1&&this.progress===100&&(a=this.progress-1,statusBar.showRemoveButton()),statusBar.progressing(l(a),{percent:a}),statusBar.update_progress(this.progress,l(a))},i.prototype._showReady=function(){return this.stop(),n.showReplacementMedia()},i.prototype._showFailed=function(){return this.stop(),statusBar.clear(),statusBar.failed(b)},i}(),n}.call(this);var ReplaceVideoUploader;ReplaceVideoUploader=function(){function k(){}var a,b,c,d,e,f,g,h,i,j;return a=wJQuery,h=Wistia,j=null,i=null,k.load=function(a){return j==null&&(j=new e),i=a,j.start(),j},b=WistiaContext.bakery.uploadUrlRoot,f=b+"/medias.html",c=b+"/medias",g="upload_form",d="replacement_progress",e=function(){function b(){}return b.prototype.start=function(){return this.creds=this._initCredentials(),this.$form=this._initFormValues(g),this.uploader=this._initUploader(this.$form),this._showUploadForm(),this._attachEventHandlers()},b.prototype._initFormValues=function(b){var c,d,e;return d=a("#"+b),d.attr("action",this.creds.uploadUrl),d.find('[name="signature"]').attr("value",this.creds.signature),d.find('[name="expires"]').attr("value",this.creds.expires),this._oldInternetExplorerDetected()&&(c=d.find('[name="redirect_to"]'),e=c.val()+"&is_simple_upload=true",c.attr("value",e)),d},b.prototype._initCredentials=function(){return this._oldInternetExplorerDetected()?{uploadUrl:f,signature:WistiaContext.bakery.creds.html.signature,expires:WistiaContext.bakery.creds.html.expires}:{uploadUrl:c,signature:WistiaContext.bakery.creds["default"].signature,expires:WistiaContext.bakery.creds["default"].expires}},b.prototype._initUploader=function(a){var b=this;return this.uploader=new Html5Uploader(g),this.progressBar=new Html5Progress(d),this.uploader.onSubmit=function(a){b._showUploadProgress();if(b._swapIsSelected)return b._showSwapInfo},this.uploader.onProgress=function(a){return b.progressBar.update(a,""+a+"%")},this.uploader.onSuccess=function(){return b._replaceVideo()},this.uploader.onError=function(){return b._showUploadFailed()},this.uploader},b.prototype._attachEventHandlers=function(){var b=this;return a(".file-input").on("change",function(){return b._uploadVideo()}),a("#replacement_cancel button").on("click",function(){return b._cancelUpload()}),a("#reattempt button").on("click",function(){return b._showUploadForm()})},b.prototype._cancelUpload=function(){var a=this;return this.uploader.abort(),this.progressBar.update(0,"0%"),setTimeout(function(){return a._showUploadForm()},500)},b.prototype._replaceVideo=function(){var b;return this._disableCancelButton(),this._swapIsSelected()?b=this._swapRedirectUrl():b=this._overwriteRedirectUrl(),a.ajax({url:b,method:"get",success:function(b){return Cookies.set("queued_for_replacement",i),a.facebox.close(),window.location.reload()},error:function(b){return statusBar.error("An error occurred after uploading."),a.facebox.close()}})},b.prototype._uploadVideo=function(){return this.uploader.submit()},b.prototype._hideAllElements=function(){return a(".close").hide(),a("#replace-video > div").each(function(b,c){return a(c).hide()})},b.prototype._showUploadForm=function(){return this._hideAllElements(),a(".close").show(),a("#modal_title").text("Replace Video"),this.$form[0].reset(),a("#replace-video > #upload").show()},b.prototype._showUploadProgress=function(){return this._hideAllElements(),a("#modal_title").text("Uploading replacement..."),this._oldInternetExplorerDetected()&&a("#replacement_progress").hide(),a("#uploading_replacement").show()},b.prototype._showUploadFailed=function(){return this._hideAllElements(),a("#modal_title").text("Upload failed"),a("#upload_failed").show()},b.prototype._showSwapInfo=function(){return a("#swap_info").show()},b.prototype._disableCancelButton=function(){return a("#replacement_cancel button").attr("disabled",!0)},b.prototype._swapIsSelected=function(){return this.$form.find(".swap").is(":checked")},b.prototype._replacementMethod=function(){var a;return(a=this._swapIsSelected)!=null?a:{swap:"overwrite"}},b.prototype._swapRedirectUrl=function(){return this.$form.find(".swap").val()},b.prototype._overwriteRedirectUrl=function(){return this.$form.find(".overwrite").val()},b.prototype._oldInternetExplorerDetected=function(){return h.detect.browser.msie&&h.detect.browser.version<=9},b}(),k}()